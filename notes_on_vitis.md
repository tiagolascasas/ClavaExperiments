# Notes on AMD Vitis 2023.2

## General topics

General notes and thoughts about Vitis 2023.2

### Part number nomenclature

Commonly used parts | Part reference
---|---
Zynq UltraScale+ MPSoC ZCU102 | xczu9eg-ffvb1156-1-i
Alveo U250 | TBD

Speed grade is the number after the reference, with -1 being the slowest adn -3 being the fastest

Suffixes -i and -e denote industry and evaluation, respectively (needs confirmation)

### Recommended project structure

Root directory is the workspace folder, which you should create for each project/app. Do not mix unrelated components and source code in the same workspace, because it *will* get messy. For instance, if you have two applications **foo** and **bar**, we recommend the following structure:

- workspace folder "**foo**"
  - folder 1 (e.g., HLS component for the kernel part of **foo**)
  - folder 2 (e.g., Application component for the host part of **foo**)
  - src folder with the C/C++ code of **foo**
- workspace folder "**bar**"
  - etc etc

Different components can access the same source code, as long as you keep it in this structure. Regardless of whether you only want to synthesize a C/C++ kernel with an HLS component, or build a hybrid host-kernel application using OpenCL/XRT, it is important that you separate your kernel code in its own file. It should be isolated from all other code, such as the test bench code for an HLS kernel, or the host code for an hybrid application.

### License management

Licenses go on the root of $HOME/.Xilinx

## HLS Components

Notes and thoughts about the HLS components of Vitis 2023.2.

Most relevant document: <https://docs.amd.com/r/en-US/ug1399-vitis-hls>

### Flow target

You can choose between Vivado and Vitis flow targets. The major difference is that the former generates a Vivado IP, leaving the integration up to you, while the latter prepackages the kernel with all the proper interfaces for interacting with the XRT/OpenCL APIs.

When specifying the Vitis Kernel Flow in the IDE, the tool implements interface ports using the AXI standard as described in Interfaces for Vitis Kernel Flow. If there are no existing INTERFACE pragmas or directives in the code, then the following interface protocols will be applied by default:

- AXI4-Lite interfaces (s_axilite) are assigned to scalar arguments, control signals for arrays, and the return value of the software function.
- AXI4 Master interfaces (m_axi) are assigned to pointer and array arguments of the C/C++ function.
- Vitis HLS automatically tries to infer BURST transactions whenever possible to aggregate memory accesses to maximize the throughput bandwidth and/or minimize the latency.
- Defining a software function argument using an hls::stream data type implies an AXI4-Stream (axis) port.

### Development Flows

- C Simulation - pure SW run, to validate test bench correctness
- C Synthesis - runs the first step of synthesis for a given kernel (i.e., outputs RTL in "impl", and the reports in "syn")
- C/RTL Cosimulation - emulates the generated RTL alongside the SW version to verify the correctness of the generated RTL
- Package - packages the RTL in the format specified in the project configuration. See output formats for more info
- Implementation - Place-and-route of the RTL into a bitstream. It may fail if it doesn't find a license for the target platform.

### Output Formats

Format|Filename|Purpose
---|---|---
Vivado IP | comp-name.zip | For adding to the Vivado IP catalog
Vivado IP for System Generator | comp-name.zip | For use with the Vivado edition of the System Generator for DSP
XO file | comp-name.xo | For linking with host code using Vitis and/or v++
RTL, skip packaging | VHDL and Verilog folders | Default behaviour, as these files are already generated by HLS in all instances

## Application Components

Notes and thoughts about the Application component of Vitis 2023.2

## Concrete Examples

### Hybrid CPU-FPGA application on the Alveo U250 (x86 system)

### Hybrid CPU-FPGA application on the ZCU102 (ARM system)

Very important: <https://highlevel-synthesis.com/2022/06/09/how-to-emulate-an-hardware-accelerator-on-zcu102-in-vitis-2022-1/>
